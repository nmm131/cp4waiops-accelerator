
# *************************************************************************************************************************************************
# --------------------------------------------------------------------------------------------------------------------------------------
# Install Demo Apps
# --------------------------------------------------------------------------------------------------------------------------------------
# *************************************************************************************************************************************************

# --------------------------------------------------------------------------------------------------------------------------------------
# Install RobotShop
# --------------------------------------------------------------------------------------------------------------------------------------
- name: DEMO -               ðŸ”Ž Check RobotShop
  k8s_info:
    kind: Namespace
    name: "robot-shop"
  register: K8S_EXISTS

- name: DEMO -               ðŸš€ Install RobotShop
  block:
  - name: DEMO -               ðŸš€ Create robot-shop namespace
    community.kubernetes.k8s:
      api_version: v1
      kind: Namespace
      name: "robot-shop"
      state: present
    #when: INSTALL_DEMO_APPS == true

  - name: DEMO -               ðŸš€ Create robot-shop service account
    shell: |
      oc adm policy add-scc-to-user privileged -n robot-shop -z robot-shop
      oc create clusterrolebinding default-robotinfo1-admin --clusterrole=cluster-admin --serviceaccount=robot-shop:robot-shop
      oc adm policy add-scc-to-user privileged -n robot-shop -z default                                
      oc create clusterrolebinding default-robotinfo2-admin --clusterrole=cluster-admin --serviceaccount=robot-shop:default
    ignore_errors: yes
    register: demo_robot_shop
    #when: INSTALL_DEMO_APPS == true
              

  - name: DEMO -               ðŸš€ Create robot-shop application
    community.kubernetes.k8s:
      state: present
      namespace: robot-shop
      src: ./templates/demo_apps/robotshop/robot-all-in-one.yaml
    #when: INSTALL_DEMO_APPS == true

  - name: DEMO -               ðŸš€ Create robot-shop load generation
    community.kubernetes.k8s:
      state: present
      namespace: robot-shop
      src: ./templates/demo_apps/robotshop/load-deployment.yaml
    #when: INSTALL_DEMO_APPS == true
  when: K8S_EXISTS.resources|length == 0



  # --------------------------------------------------------------------------------------------------------------------------------------
  # Install Kubetoy
  # --------------------------------------------------------------------------------------------------------------------------------------
- name: DEMO -               ðŸ”Ž Check Kubetoy
  k8s_info:
    kind: Namespace
    name: "kubetoy"
  register: K8S_EXISTS

- name: DEMO -               ðŸš€ Install Kubetoy
  block:
  - name: DEMO -               ðŸš€ Create kubetoy namespace
    community.kubernetes.k8s:
      api_version: v1
      kind: Namespace
      name: "kubetoy"
      state: present
    #when: INSTALL_DEMO_APPS == true
            

  - name: DEMO -               ðŸš€ Create kubetoy application
    community.kubernetes.k8s:
      state: present
      namespace: kubetoy
      src: ./templates/demo_apps/kubetoy/kubetoy_all_in_one.yaml
    #when: INSTALL_DEMO_APPS == true
  when: K8S_EXISTS.resources|length == 0

