#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#       __________  __ ___       _____    ________            
#      / ____/ __ \/ // / |     / /   |  /  _/ __ \____  _____
#     / /   / /_/ / // /| | /| / / /| |  / // / / / __ \/ ___/
#    / /___/ ____/__  __/ |/ |/ / ___ |_/ // /_/ / /_/ (__  ) 
#    \____/_/      /_/  |__/|__/_/  |_/___/\____/ .___/____/  
#                                              /_/            
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#---------------------------------------------------------------------------------------------------------------------------------------------------"
#  CP4WAIOPS 3.2 - Get Logins and URLs
#
#
#  Â©2021 nikh@ch.ibm.com
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"


echo "***************************************************************************************************************************************************"
echo "***************************************************************************************************************************************************"
echo "***************************************************************************************************************************************************"
echo "***************************************************************************************************************************************************"
echo ""
echo ""
echo ""
echo "   __________  __ ___       _____    ________            "
echo "  / ____/ __ \/ // / |     / /   |  /  _/ __ \____  _____"
echo " / /   / /_/ / // /| | /| / / /| |  / // / / / __ \/ ___/"
echo "/ /___/ ____/__  __/ |/ |/ / ___ |_/ // /_/ / /_/ (__  ) "
echo "\____/_/      /_/  |__/|__/_/  |_/___/\____/ .___/____/  "
echo "                                   /_/            "
echo ""
echo ""
echo ""
echo "  "
echo "  ğŸš€ CloudPak for Watson AIOps 3.2 - Logins and URLs "
echo "  "
echo "***************************************************************************************************************************************************"
echo "***************************************************************************************************************************************************"
echo "***************************************************************************************************************************************************"
echo "  "
echo "  "
export TEMP_PATH=~/aiops-install

# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# Do Not Edit Below
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"



export WAIOPS_NAMESPACE=$(oc get po -A|grep aimanager-operator |awk '{print$1}')
export EVTMGR_NAMESPACE=$(oc get po -A|grep noi-operator |awk '{print$1}')

CLUSTER_ROUTE=$(oc get routes console -n openshift-console | tail -n 1 2>&1 ) 
CLUSTER_FQDN=$( echo $CLUSTER_ROUTE | awk '{print $2}')
CLUSTER_NAME=${CLUSTER_FQDN##*console.}






echo "***************************************************************************************************************************************************"
echo "***************************************************************************************************************************************************"
echo "ğŸš€ CloudPak for Watson AIOps"
echo "***************************************************************************************************************************************************"
echo "***************************************************************************************************************************************************"
echo "    "
echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
echo "    ğŸš€ AI Manager"
echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
echo "    "
echo "      ğŸ“¥ AI Manager"
echo ""
echo "                ğŸŒ URL:      https://$(oc get route -n $WAIOPS_NAMESPACE cpd -o jsonpath={.spec.host})"
echo "                ğŸ§‘â€ğŸ¦³ User:     demo"
echo "                ğŸ” Password: P4ssw0rd!"
echo ""
echo "                ğŸ§‘â€ğŸ¦³ User:     $(oc -n ibm-common-services get secret platform-auth-idp-credentials -o jsonpath='{.data.admin_username}' | base64 --decode && echo)"
echo "                ğŸ” Password: $(oc -n ibm-common-services get secret platform-auth-idp-credentials -o jsonpath='{.data.admin_password}' | base64 --decode)"
echo "     "
echo "     "
echo "     "       
echo "      ğŸ“¥ Administration hub / Common Services"
echo ""
echo "                ğŸŒ URL:      https://$(oc get route -n ibm-common-services cp-console -o jsonpath={.spec.host})"
echo "                ğŸ§‘â€ğŸ¦³ User:     demo"
echo "                ğŸ” Password: P4ssw0rd!"
echo ""
echo "                ğŸ§‘â€ğŸ¦³ User:     $(oc -n ibm-common-services get secret platform-auth-idp-credentials -o jsonpath='{.data.admin_username}' | base64 --decode && echo)"
echo "                ğŸ” Password: $(oc -n ibm-common-services get secret platform-auth-idp-credentials -o jsonpath='{.data.admin_password}' | base64 --decode)"
echo "    "
echo "    "
echo "    "
echo "    "
    





EVTMGR_READY=$(oc get pod -n $EVTMGR_NAMESPACE | grep webgui-0|| true) 
if [[ $EVTMGR_READY =~ "2/2" ]]; 
then
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    ğŸš€ Event Manager (Netcool Operations Insight)"
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    "
    echo "      ğŸ“¥ Event Manager"
    echo ""
    echo "            ğŸŒ URL:      https://$(oc get route -n $EVTMGR_NAMESPACE  evtmanager-ibm-hdm-common-ui -o jsonpath={.spec.host})"
    echo "            ğŸ§‘â€ğŸ¦³ User:     demo"
    echo "            ğŸ” Password: P4ssw0rd!"
    echo ""
    echo "            ğŸ§‘â€ğŸ¦³ User:     smadmin"
    echo "            ğŸ” Password: $(oc get secret -n $EVTMGR_NAMESPACE  evtmanager-was-secret -o jsonpath='{.data.WAS_PASSWORD}'| base64 --decode && echo)"
    echo ""
    echo "       ---------------------------------------------------------------------------------------------"
    echo "        EventManager/NOI WEBHOOK:"
    echo "            URL:   <PASTE HERE FOR DOCUMENTATION WHEN CREATED>"
    echo "    "
    echo "    "
    echo "    "
    echo "    "
fi




echo "***************************************************************************************************************************************************"
echo "***************************************************************************************************************************************************"
echo "ğŸš€ Additional Components"
echo "***************************************************************************************************************************************************"
echo "***************************************************************************************************************************************************"
echo "    "
echo "    "
echo "    "

TURBO_READY=$(oc get ns turbonomic || true) 
if [[ $TURBO_READY =~ "Active" ]]; 
then
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    ğŸš€ Turbonomic Dashboard "
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    "
    echo "            ğŸ“¥ Turbonomic Dashboard :"
    echo ""
    echo "                ğŸŒ URL:      https://api-turbonomic.$CLUSTER_NAME/"
    echo "                ğŸ§‘â€ğŸ¦³ User:     administrator"
    echo "                ğŸ” Password: As set at init step"
    echo "    "
    echo "    "
    echo "    "
    echo "    "
fi




HUMIO_READY=$(oc get ns humio-logging || true) 
if [[ $HUMIO_READY =~ "Active" ]]; 
then

    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    ğŸš€ HUMIO "
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    "
    echo "            ğŸ“¥ HUMIO:"
    echo ""
    echo "                ğŸŒ URL:      http://$(oc get route -n humio-logging humio -o jsonpath={.spec.host})"
    echo "                ğŸ§‘â€ğŸ¦³ User:     developer"
    echo "                ğŸ” Password: P4ssw0rd!"
    echo "    "
    echo "    "
    echo "    "
    echo "                INTEGRATION URL:      http://$(oc get route -n humio-logging humio -o jsonpath={.spec.host})/api/v1/repositories/aiops/query"
    echo "    "
    echo "    "
    echo "    "
    echo "    "
fi





ISTIO_READY=$(oc get ns istio-system || true) 
if [[ $ISTIO_READY =~ "Active" ]]; 
then

    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    ğŸš€ ServiceMesh/ISTIO "
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    "
    echo "            ğŸ“¥ ServiceMesh:"
    echo ""
    echo "                ğŸŒ RobotShop:     http://$(oc get route -n istio-system istio-ingressgateway -o jsonpath={.spec.host})"
    echo "                ğŸŒ Kiali:         https://$(oc get route -n istio-system kiali -o jsonpath={.spec.host})"
    echo "                ğŸŒ Jaeger:        https://$(oc get route -n istio-system jaeger -o jsonpath={.spec.host})"
    echo "                ğŸŒ Grafana:       https://$(oc get route -n istio-system grafana -o jsonpath={.spec.host})"
    echo "    "
    echo "    "
    echo "          In the begining all traffic is routed to ratings-test"
    echo "            You can modify the routing by executing:"
    echo "              All Traffic to test:    oc apply -n robot-shop -f ./ansible/templates/demo_apps/robotshop/istio/canary-100-0.yaml"
    echo "              Traffic split 50-50:    oc apply -n robot-shop -f ./ansible/templates/demo_apps/robotshop/istio/canary-50-50.yaml"
    echo "              All Traffic to prod:    oc apply -n robot-shop -f ./ansible/templates/demo_apps/robotshop/istio/canary-0-100.yaml"
    echo "    "
    echo "    "
    echo "    "
fi


AWX_READY=$(oc get ns awx || true) 
if [[ $AWX_READY =~ "Active" ]]; 
then
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    ğŸš€ AWX "
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    "
    echo "            ğŸ“¥ AWX :"
    echo ""
    echo "                ğŸŒ URL:      https://$(oc get route -n awx awx -o jsonpath={.spec.host})"
    echo "                ğŸ§‘â€ğŸ¦³ User:     admin"
    echo "                ğŸ” Password: $(oc -n awx get secret awx-admin-password -o jsonpath='{.data.password}' | base64 --decode && echo)"
    echo "    "
    echo "    "
    echo "    "
    echo "    "
fi



MIQ_READY=$(oc get ns manageiq || true) 
if [[ $MIQ_READY =~ "Active" ]]; 
then
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    ğŸš€ ManageIQ "
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    "
    echo "            ğŸ“¥ ManageIQ :"
    echo ""
    echo "                ğŸŒ URL:      https://$(oc get route -n manageiq $(oc get route -n manageiq|grep httpd|awk '{print$1}') -o jsonpath={.spec.host})"
    echo "                ğŸ§‘â€ğŸ¦³ User:     admin"
    echo "                ğŸ” Password: smartvm"
    echo "    "
    echo "    "
    echo "    "
    echo "    "
fi




DEMO_READY=$(oc get ns robot-shop || true) 
if [[ $DEMO_READY =~ "Active" ]]; 
then

    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    ğŸš€ Demo Apps - Details"
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    "
    appURL=$(oc get routes -n robot-shop web  -o jsonpath="{['spec']['host']}")|| true
    echo "            ğŸ“¥ RobotShop:"   
    echo "    " 
    echo "                ğŸŒ APP URL:           http://$appURL/"

    echo ""
    echo ""
    appURL=$(oc get routes -n kubetoy kubetoy  -o jsonpath="{['spec']['host']}")|| true

    echo "            ğŸ“¥ Kubetoy:"
    echo "    " 
    echo "                ğŸŒ APP URL:           http://$appURL/"
    echo ""
    echo ""
    echo ""
    echo ""
fi



echo "***************************************************************************************************************************************************"
echo "***************************************************************************************************************************************************"
echo "ğŸš€ Openshift Connection Details"
echo "***************************************************************************************************************************************************"
echo "***************************************************************************************************************************************************"
echo ""
echo "  ğŸ“¥ Openshift Console"
echo ""
echo "            ğŸŒ URL:      https://$(oc get route -n openshift-console console -o jsonpath={.spec.host})"
echo " "
echo " "
echo " "
echo "  ğŸ“¥ Openshift Command Line"
echo ""
DEMO_TOKEN=$(oc -n default get secret $(oc get secret -n default |grep -m1 demo-admin-token|awk '{print$1}') -o jsonpath='{.data.token}'|base64 --decode)
DEMO_URL=$(oc status|grep -m1 "In project"|awk '{print$6}')
echo "            ğŸŒ URL:     $DEMO_URL"
echo "            ğŸ” Token:   $DEMO_TOKEN"
echo ""
echo ""
echo "            ğŸ§‘â€ğŸ¦³ Login:   oc login --token=$DEMO_TOKEN --server=$DEMO_URL"
echo ""
echo ""
echo ""
echo ""
echo ""
echo ""
echo ""


echo "    "
echo "    "
echo "    "
echo "    "
echo "    "
echo "    "
echo "    "
echo "    "
echo "    "
echo "    "
echo "    "
echo "    "
echo "***************************************************************************************************************************************************"
echo "***************************************************************************************************************************************************"
echo "ğŸš€ CloudPak for Watson AIOps - Technical Links"
echo "***************************************************************************************************************************************************"
echo "***************************************************************************************************************************************************"
echo "    "
echo "    "
echo "    "
echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
echo "    ğŸš€ CP4WAIOPS Vault"
echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
echo "    " 
echo "            ğŸ“¥ Vault:"
echo "    " 
echo "                ğŸŒ URL:      https://$(oc get route -n $WAIOPS_NAMESPACE ibm-vault-deploy-vault-route -o jsonpath={.spec.host})"
echo "                ğŸ” Token:    $(oc get secret -n $WAIOPS_NAMESPACE ibm-vault-deploy-vault-credential -o jsonpath='{.data.token}' | base64 --decode && echo)"
echo "    "
echo "    "
echo "    "
echo "    "


echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
echo "    ğŸš€ LDAP "
echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
echo "    " 
echo "            ğŸ“¥ OPENLDAP:"
echo "    " 
echo "                ğŸŒ URL:      http://openldap-admin-default.$CLUSTER_NAME/"
echo "                ğŸ§‘â€ğŸ¦³ User:     cn=admin,dc=ibm,dc=com"
echo "                ğŸ” Password: P4ssw0rd!"
echo "    "
echo "    "
echo "    "
echo "    "





echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
echo "    ğŸš€ Flink Task Manager"
echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
appURL=$(oc get routes -n $WAIOPS_NAMESPACE job-manager  -o jsonpath="{['spec']['host']}")
echo "    " 
echo "            ğŸ“¥ Flink Task Manager:"
echo "    " 
echo "                ğŸŒ APP URL:           https://$appURL/"
echo "    "
echo "                In Chrome: if you get blocked just type "thisisunsafe" and it will continue (you don't get any visual feedback when typing!)"
echo "    "
echo "    "
echo "    "
echo "    "





ELK_READY=$(oc get ns openshift-logging || true) 
if [[ $ELK_READY =~ "Active" ]]; 
then
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    ğŸš€ ELK "
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    token=$(oc sa get-token cluster-logging-operator -n openshift-logging)
    routeES=`oc get route elasticsearch -o jsonpath={.spec.host} -n openshift-logging`
    routeKIBANA=`oc get route kibana -o jsonpath={.spec.host} -n openshift-logging`
    echo "      "
    echo "            ğŸ“¥ ELK:"
    echo "      "
    echo "               ğŸŒ ELK service URL             : https://$routeES/app*"
    echo "               ğŸ” Authentication type         : Token"
    echo "               ğŸ” Token                       : $token"
    echo "      "
    echo "               ğŸŒ Kibana URL                  : https://$routeKIBANA"
    echo "               ğŸšª Kibana port                 : 443"
    echo "               ğŸ—ºï¸  Mapping                     : "
    echo "{ "
    echo "  \"codec\": \"elk\","
    echo "  \"message_field\": \"message\","
    echo "  \"log_entity_types\": \"kubernetes.container_image_id, kubernetes.host, kubernetes.pod_name, kubernetes.namespace_name\","
    echo "  \"instance_id_field\": \"kubernetes.container_name\","
    echo "  \"rolling_time\": 10,"
    echo "  \"timestamp_field\": \"@timestamp\""
    echo "}"
    echo "  "
    echo ""
    echo ""
    echo ""
fi






ROOK_READY=$(oc get ns rook-ceph || true) 
if [[ $ROOK_READY =~ "Active" ]]; 
then
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    ğŸš€ Rook/Ceph Dashboard "
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
    echo "    " 
    echo "            ğŸ“¥ Rook/Ceph Dashboard :"
    echo "    " 
    echo "                ğŸŒ URL:      https://dash-rook-ceph.$CLUSTER_NAME/"
    echo "                ğŸ§‘â€ğŸ¦³ User:     admin"
    echo "                ğŸ” Password: $(oc -n rook-ceph get secret rook-ceph-dashboard-password -o jsonpath="{['data']['password']}" | base64 --decode)"
    echo "    "
    echo "    "
    echo "    "
    echo "    "    
fi





echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
echo "    ğŸš€ Service Now "
echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
echo "    -----------------------------------------------------------------------------------------------------------------------------------------------"
echo "    " 
echo "            ğŸ“¥ Login SNOW Dev Portal (if you have to wake the dev instance):"
echo "    " 
echo "                ğŸŒ URL:                   https://developer.servicenow.com/dev.do"
echo "                ğŸ§‘â€ğŸ¦³ User:                  demo@mydemo.center"
echo "                ğŸ” Password:              P4ssw0rd!IBM"
echo ""
echo ""
echo "            ğŸ“¥  Login SNOW Instance::"
echo ""
echo "                ğŸŒ URL:                   https://dev56805.service-now.com"
echo "                ğŸ§‘â€ğŸ¦³ User ID:               abraham.lincoln             (if you followed the demo install instructions)"
echo "                ğŸ” Password:              P4ssw0rd!                   (if you followed the demo install instructions)"
echo "                ğŸ” Encrypted Password:    g4W3L7/eFsUjV0eMncBkbg==    (if you followed the demo install instructions)"
echo ""
echo ""
echo "            ğŸ“¥ INTEGRATION SNOW-->CP4WAIOPS:"
echo "    " 
echo "                ğŸŒ URL:                   https://cpd-aiops.$CLUSTER_NAME    (URL for IBM Watson AIOps connection)"
echo "                ğŸ“› Instance Name:         aimanager"
echo "                ğŸ§‘â€ğŸ¦³ User:                  admin"
echo "                ğŸ” Password:              $(oc -n ibm-common-services get secret platform-auth-idp-credentials -o jsonpath='{.data.admin_password}' | base64 --decode)"
echo ""
echo ""
echo ""
echo ""
echo ""
echo ""
