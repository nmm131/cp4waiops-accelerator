- name: Check RobotShop
  k8s_info:
    kind: Namespace
    name: "robot-shop"
  register: K8S_EXISTS

- name: Install RobotShop
  block:
  - name: Create robot-shop namespace
    core.kubernetes.k8s:
      api_version: v1
      kind: Namespace
      name: "robot-shop"
      state: present
    #when: INSTALL_DEMO_APPS == true

  - name: Create robot-shop service account
    shell: |
      oc adm policy add-scc-to-user privileged -n robot-shop -z robot-shop
      oc create clusterrolebinding default-robotinfo1-admin --clusterrole=cluster-admin --serviceaccount=robot-shop:robot-shop
      oc adm policy add-scc-to-user privileged -n robot-shop -z default                                
      oc create clusterrolebinding default-robotinfo2-admin --clusterrole=cluster-admin --serviceaccount=robot-shop:default
    ignore_errors: yes
    register: demo_robot_shop
    #when: INSTALL_DEMO_APPS == true
              

  - name: Create robot-shop application
    core.kubernetes.k8s:
      state: present
      namespace: robot-shop
      src: ./files/robot-all-in-one.yaml
    #when: INSTALL_DEMO_APPS == true

  - name: Create robot-shop load generation
    core.kubernetes.k8s:
      state: present
      namespace: robot-shop
      src: ./files/load-deployment.yaml
    #when: INSTALL_DEMO_APPS == true
  when: K8S_EXISTS.resources|length == 0

- name: Check Kubetoy
  k8s_info:
    kind: Namespace
    name: "kubetoy"
  register: K8S_EXISTS

- name: Install Kubetoy
  block:
  - name: Create kubetoy namespace
    core.kubernetes.k8s:
      api_version: v1
      kind: Namespace
      name: "kubetoy"
      state: present
    #when: INSTALL_DEMO_APPS == true
            

  - name: Create kubetoy application
    core.kubernetes.k8s:
      state: present
      namespace: kubetoy
      src: ./files/kubetoy_all_in_one.yaml
    #when: INSTALL_DEMO_APPS == true
  when: K8S_EXISTS.resources|length == 0

